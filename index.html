<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Photo Editor Max</title>
    <style>
        :root { --bg: #000; --panel: #1a1a1a; --accent: #00d1b2; --text: #fff; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .toolbar { display: flex; justify-content: space-between; padding: 10px 15px; background: #111; z-index: 10; }
        .viewport { flex: 1; display: flex; align-items: center; justify-content: center; overflow: auto; background: radial-gradient(#333, #000); }
        canvas { max-width: 95%; max-height: 95%; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .bottom-panel { background: var(--panel); border-top: 1px solid #333; }
        .tabs { display: flex; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 12px; text-align: center; font-size: 12px; cursor: pointer; color: #888; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .controls-scroll { display: none; overflow-x: auto; white-space: nowrap; padding: 12px; gap: 8px; }
        .controls-scroll.active { display: flex; }
        .btn-item { min-width: 80px; display: flex; flex-direction: column; align-items: center; background: #2a2a2a; padding: 8px; border-radius: 8px; }
        .btn-item label { font-size: 10px; margin-bottom: 4px; color: #aaa; }
        button { background: #444; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 11px; cursor: pointer; width: 100%; }
        button:active { background: var(--accent); color: #000; }
        .primary { background: var(--accent); color: #000; font-weight: bold; }
        input[type="range"] { width: 70px; accent-color: var(--accent); }
    </style>
</head>
<body>

<div class="toolbar">
    <button onclick="document.getElementById('upload').click()">ğŸ“‚ ç”»åƒé¸æŠ</button>
    <button class="primary" onclick="downloadImage()">ğŸ’¾ ä¿å­˜</button>
    <input type="file" id="upload" hidden accept="image/*">
</div>

<div class="viewport">
    <canvas id="canvas"></canvas>
</div>

<div class="bottom-panel">
    <div class="tabs">
        <div class="tab active" onclick="switchTab(0)">åŸºæœ¬/å¤‰å½¢</div>
        <div class="tab" onclick="switchTab(1)">é«˜åº¦åŠ å·¥</div>
        <div class="tab" onclick="switchTab(2)">ã‚¢ãƒ¼ãƒˆ/è£…é£¾</div>
    </div>

    <div id="tab0" class="controls-scroll active">
        <div class="btn-item"><label>æ˜ã‚‹ã•</label><input type="range" id="brightness" min="0" max="200" value="100" onchange="applyFilters()"></div>
        <div class="btn-item"><label>å½©åº¦</label><input type="range" id="saturate" min="0" max="200" value="100" onchange="applyFilters()"></div>
        <div class="btn-item"><label>å›è»¢</label><button onclick="rotate()">90Â°å›è»¢</button></div>
        <div class="btn-item"><label>åè»¢H</label><button onclick="flip('h')">å·¦å³åè»¢</button></div>
        <div class="btn-item"><label>åè»¢V</label><button onclick="flip('v')">ä¸Šä¸‹åè»¢</button></div>
        <div class="btn-item"><label>ã‚ºãƒ¼ãƒ </label><button onclick="zoom(1.2)">æ‹¡å¤§</button></div>
        <div class="btn-item"><label>ãƒªã‚»ãƒƒãƒˆ</label><button onclick="resetAll()">åˆæœŸåŒ–</button></div>
    </div>

    <div id="tab1" class="controls-scroll">
        <div class="btn-item"><label>ãƒ¢ã‚¶ã‚¤ã‚¯</label><button onclick="pixelate()">é©ç”¨</button></div>
        <div class="btn-item"><label>2å€¤åŒ–</label><button onclick="threshold()">é©ç”¨</button></div>
        <div class="btn-item"><label>ã‚·ãƒ£ãƒ¼ãƒ—</label><button onclick="convolute([-1,-1,-1,-1,9,-1,-1,-1,-1])">é©ç”¨</button></div>
        <div class="btn-item"><label>è¼ªéƒ­</label><button onclick="convolute([0,1,0,1,-4,1,0,1,0])">æŠ½å‡º</button></div>
        <div class="btn-item"><label>ã‚¨ãƒ³ãƒœã‚¹</label><button onclick="convolute([-2,-1,0,-1,1,1,0,1,2])">é©ç”¨</button></div>
        <div class="btn-item"><label>ãƒã‚¤ã‚º</label><button onclick="addNoise()">åŠ ç­†</button></div>
        <div class="btn-item"><label>ãƒ“ãƒãƒƒãƒˆ</label><button onclick="vignette()">å‘¨è¾ºæ¸›å…‰</button></div>
    </div>

    <div id="tab2" class="controls-scroll">
        <div class="btn-item"><label>ã‚»ãƒ”ã‚¢</label><button onclick="quickFilter('sepia(1)')">ã‚»ãƒ”ã‚¢</button></div>
        <div class="btn-item"><label>ãƒ¢ãƒã‚¯ãƒ­</label><button onclick="quickFilter('grayscale(1)')">ãƒ¢ãƒã‚¯ãƒ­</button></div>
        <div class="btn-item"><label>ãƒã‚¬</label><button onclick="quickFilter('invert(1)')">åè»¢</button></div>
        <div class="btn-item"><label>ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸</label><button onclick="quickFilter('sepia(0.5) hue-rotate(-30deg) contrast(1.2)')">é©ç”¨</button></div>
        <div class="btn-item"><label>ãƒŠã‚¤ãƒˆ</label><button onclick="quickFilter('brightness(0.6) hue-rotate(180deg) saturate(1.5)')">å¤œæ™¯é¢¨</button></div>
        <div class="btn-item"><label>æ—¥ä»˜</label><button onclick="addTimestamp()">æ—¥ä»˜åˆ»å°</button></div>
        <div class="btn-item"><label>ãƒ•ãƒ¬ãƒ¼ãƒ </label><button onclick="addFrame()">ç™½æ </button></div>
        <div class="btn-item"><label>ã‚µã‚¤ãƒ³</label><button onclick="addWatermark()">Sign</button></div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let img = new Image();
    let offCanvas = document.createElement('canvas'); // çŠ¶æ…‹ä¿æŒç”¨
    let octx = offCanvas.getContext('2d');

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
        document.querySelectorAll('.controls-scroll').forEach((c, i) => c.classList.toggle('active', i === idx));
    }

    // ç”»åƒèª­ã¿è¾¼ã¿
    document.getElementById('upload').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (f) => {
            img.onload = () => {
                canvas.width = offCanvas.width = img.width;
                canvas.height = offCanvas.height = img.height;
                octx.drawImage(img, 0, 0);
                commit();
            };
            img.src = f.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºå®šã•ã›ã‚‹
    function commit() {
        ctx.filter = 'none';
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.drawImage(offCanvas, 0, 0);
    }

    // 1-10. åŸºæœ¬ãƒ•ã‚£ãƒ«ã‚¿
    function applyFilters() {
        const b = document.getElementById('brightness').value;
        const s = document.getElementById('saturate').value;
        ctx.filter = `brightness(${b}%) saturate(${s}%)`;
        ctx.drawImage(offCanvas, 0, 0);
    }

    // 11-15. å¤‰å½¢ç³»
    function rotate() {
        let w = canvas.width, h = canvas.height;
        canvas.width = h; canvas.height = w;
        ctx.translate(canvas.width/2, canvas.height/2);
        ctx.rotate(90 * Math.PI / 180);
        ctx.drawImage(offCanvas, -w/2, -h/2);
        updateOffCanvas();
    }
    function flip(dir) {
        ctx.save();
        if(dir==='h') { ctx.scale(-1, 1); ctx.drawImage(offCanvas, -canvas.width, 0); }
        else { ctx.scale(1, -1); ctx.drawImage(offCanvas, 0, -canvas.height); }
        ctx.restore();
        updateOffCanvas();
    }
    function zoom(v) {
        const w = canvas.width * v, h = canvas.height * v;
        canvas.width = w; canvas.height = h;
        ctx.drawImage(offCanvas, 0, 0, w, h);
        updateOffCanvas();
    }

    // 16-20. ãƒ”ã‚¯ã‚»ãƒ«æ“ä½œç³»
    function pixelate() {
        const size = 10;
        for(let y=0; y<canvas.height; y+=size) {
            for(let x=0; x<canvas.width; x+=size) {
                const p = ctx.getImageData(x, y, 1, 1).data;
                ctx.fillStyle = `rgb(${p[0]},${p[1]},${p[2]})`;
                ctx.fillRect(x, y, size, size);
            }
        }
        updateOffCanvas();
    }

    function threshold() {
        const d = ctx.getImageData(0,0,canvas.width,canvas.height);
        for(let i=0; i<d.data.length; i+=4) {
            const v = (d.data[i]+d.data[i+1]+d.data[i+2])/3 > 128 ? 255 : 0;
            d.data[i]=d.data[i+1]=d.data[i+2]=v;
        }
        ctx.putImageData(d,0,0);
        updateOffCanvas();
    }

    // ç•³ã¿è¾¼ã¿ç©åˆ† (ã‚·ãƒ£ãƒ¼ãƒ—ã€è¼ªéƒ­æŠ½å‡ºç­‰)
    function convolute(weights) {
        const side = Math.round(Math.sqrt(weights.length));
        const halfSide = Math.floor(side/2);
        const src = ctx.getImageData(0,0,canvas.width, canvas.height);
        const sw = src.width, sh = src.height;
        const output = ctx.createImageData(sw, sh);
        for (let y=0; y<sh; y++) {
            for (let x=0; x<sw; x++) {
                let r=0, g=0, b=0;
                for (let cy=0; cy<side; cy++) {
                    for (let cx=0; cx<side; cx++) {
                        const scy = y + cy - halfSide;
                        const scx = x + cx - halfSide;
                        if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {
                            const srcOff = (scy*sw+scx)*4;
                            const wt = weights[cy*side+cx];
                            r += src.data[srcOff] * wt;
                            g += src.data[srcOff+1] * wt;
                            b += src.data[srcOff+2] * wt;
                        }
                    }
                }
                const dstOff = (y*sw+x)*4;
                output.data[dstOff]=r; output.data[dstOff+1]=g; output.data[dstOff+2]=b; output.data[dstOff+3]=255;
            }
        }
        ctx.putImageData(output, 0, 0);
        updateOffCanvas();
    }

    // 21-30. ãƒ•ã‚£ãƒ«ã‚¿ãƒ»è£…é£¾
    function quickFilter(f) {
        ctx.filter = f;
        ctx.drawImage(offCanvas, 0, 0);
        updateOffCanvas();
    }

    function addTimestamp() {
        ctx.font = "bold 30px sans-serif";
        ctx.fillStyle = "rgba(255,140,0,0.7)";
        ctx.fillText(new Date().toLocaleDateString(), canvas.width-200, canvas.height-30);
        updateOffCanvas();
    }

    function addFrame() {
        ctx.strokeStyle = "white"; ctx.lineWidth = 40; ctx.strokeRect(0,0,canvas.width,canvas.height);
        updateOffCanvas();
    }

    function vignette() {
        const grd = ctx.createRadialGradient(canvas.width/2, canvas.height/2, canvas.width*0.2, canvas.width/2, canvas.height/2, canvas.width*0.8);
        grd.addColorStop(0, "transparent");
        grd.addColorStop(1, "rgba(0,0,0,0.7)");
        ctx.fillStyle = grd; ctx.fillRect(0,0,canvas.width, canvas.height);
        updateOffCanvas();
    }

    function addNoise() {
        const d = ctx.getImageData(0,0,canvas.width,canvas.height);
        for(let i=0; i<d.data.length; i+=4) {
            const r = (Math.random()-0.5)*50;
            d.data[i]+=r; d.data[i+1]+=r; d.data[i+2]+=r;
        }
        ctx.putImageData(d,0,0);
        updateOffCanvas();
    }

    function addWatermark() {
        ctx.font = "20px cursive"; ctx.fillStyle = "rgba(255,255,255,0.3)";
        ctx.fillText("Edited with HTML5", 20, canvas.height-20);
        updateOffCanvas();
    }

    function updateOffCanvas() {
        offCanvas.width = canvas.width;
        offCanvas.height = canvas.height;
        octx.drawImage(canvas, 0, 0);
        commit();
    }

    function resetAll() {
        offCanvas.width = img.width; offCanvas.height = img.height;
        octx.drawImage(img, 0, 0);
        document.getElementById('brightness').value = 100;
        document.getElementById('saturate').value = 100;
        commit();
    }

    function downloadImage() {
        const a = document.createElement('a');
        a.href = canvas.toDataURL();
        a.download = 'perfect_edit.png';
        a.click();
    }
</script>
</body>
</html>
